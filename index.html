<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDR Calculator — Modern</title>
<meta name="description" content="PDR калькулятор — расчёт вмятин с удобным интерфейсом" />

<style>
:root{
  --bg-1: #eef5ff;
  --bg-2: #f7fbff;
  --accent: #0071e3;
  --accent-2: #005bb5;
  --danger: #ff3b30;
  --card-bg: rgba(255,255,255,0.85);
  --muted: #6b7280;
  --shadow: 0 10px 30px rgba(12,20,30,0.08);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  background: linear-gradient(135deg,var(--bg-1) 0%, var(--bg-2) 100%);
  color:#0f1724;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding:28px;
}

.wrap{max-width:1100px;margin:0 auto}

header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
.logo{display:flex;align-items:center;gap:12px}
.logo .mark{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 6px 18px rgba(0,113,227,0.25)}
h1{font-size:1.3rem;margin:0}
p.lead{margin:0;color:var(--muted);font-size:0.95rem}

.container{
  background:var(--card-bg);
  border-radius:22px;
  padding:18px;
  box-shadow:var(--shadow);
  backdrop-filter: blur(8px) saturate(120%);
}

.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center}

.btn{
  display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:none;cursor:pointer;font-weight:600;
  background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;box-shadow:0 6px 14px rgba(0,113,227,0.18);transition:transform .12s ease,box-shadow .12s ease,opacity .12s ease
}
.btn:active{transform:translateY(1px)}
.btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(6,95,173,0.12);box-shadow:none}
.btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(15,23,36,0.04)}
.btn.danger{background:linear-gradient(180deg,var(--danger),#d6332a);box-shadow:0 6px 14px rgba(255,59,48,0.12)}

#elements{display:flex;flex-direction:column;gap:14px}
.element-block{
  border-radius:14px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(250,250,252,0.9));border:1px solid rgba(15,23,36,0.04);
  transition:transform .15s ease,box-shadow .15s ease;display:block
}
.element-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.element-header h2{margin:0;font-size:1rem;color:var(--accent)}
.form-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
label{font-size:0.85rem;color:var(--muted)}
select,input[type=number]{padding:8px;border-radius:10px;border:1px solid rgba(15,23,36,0.06);min-width:140px}

table{width:100%;border-collapse:collapse;margin-top:12px;font-size:0.95rem}
th,td{padding:10px;border-bottom:1px solid rgba(15,23,36,0.04);text-align:left}
th{color:var(--muted);font-weight:600}
td.price{text-align:right;font-weight:700}

.element-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.element-total{font-weight:700;color:#0b1220}

.grand-total{margin-top:16px;padding:12px;border-radius:12px;background:linear-gradient(90deg,rgba(0,113,227,0.06),rgba(0,113,227,0.02));display:flex;flex-direction:column;gap:4px}
.grand-total .line{display:flex;justify-content:space-between;align-items:center}
.grand-total .label{color:var(--muted)}
.grand-total .value{font-weight:800;color:var(--accent)}

.note{font-size:0.85rem;color:var(--muted);text-align:center;margin-top:10px}

.control-bar{
  position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(255,255,255,0.95);padding:10px 14px;border-radius:28px;box-shadow:0 8px 24px rgba(12,20,30,0.12);display:flex;gap:10px;align-items:center;z-index:1200
}

@media (max-width:700px){
  .form-row{flex-direction:column}
  .control-bar{left:12px;transform:none;right:12px}
}

.example-table{margin-top:30px;border:1px solid rgba(0,0,0,0.1);border-radius:12px;overflow:hidden}
.example-table table{width:100%;border-collapse:collapse}
.example-table th, .example-table td{border:1px solid rgba(0,0,0,0.1);padding:8px;text-align:left;font-size:0.85rem}
.example-table th{background:#f0f0f0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <div class="mark">PDR</div>
      <div>
        <h1>PDR Калькулятор</h1>
        <p class="lead">Быстрый расчёт стоимости удаления вмятин. Данные сохраняются в браузере.</p>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="controls">
      
    </div>

    <div class="note">*Скидка 20% применяется при более чем 10 вмятинах по всему авто.</div>

    <div class="note"> </div>

    <div id="elements"></div>

    <div class="grand-total" id="grandTotal">
      <div class="line"><div class="label">Всего вмятин:</div><div class="value" id="totalCount">0</div></div>
      <div class="line" id="discountLine" style="display:none;"><div class="label">Скидка:</div><div class="value" id="discountValue">0 грн</div></div>
      <div class="line"><div class="label">Итого:</div><div class="value" id="totalSum">0 грн</div></div>
    </div>

    <div class="note">Пример расчёта одной вмятины: базовая цена 400 грн — затем умножается на коэффициенты.</div>


    <div class="example-table">
      <table>
        <thead>
          <tr><th>Элемент</th><th>Выбор</th><th>Коэффициент</th><th>Цена</th><th>Примечание</th></tr>
        </thead>
        <tbody>
          <tr><td>Базовая цена</td><td>-</td><td>-</td><td>400 грн</td><td>Цена за одну маленькую вмятину</td></tr>
          <tr><td>Материал</td><td>Сталь</td><td>1.0</td><td>400 грн</td><td>Без изменения</td></tr>
          <tr><td>Материал</td><td>Алюминий</td><td>1.3</td><td>400 × 1.3 = 520 грн</td><td>+30% за сложный материал</td></tr>
          <tr><td>Доступ</td><td>Хороший</td><td>1.0</td><td>520 грн</td><td>Без изменения</td></tr>
          <tr><td>Доступ</td><td>Средний</td><td>1.2</td><td>520 × 1.2 = 624 грн</td><td>+20% за средний доступ</td></tr>
          <tr><td>Доступ</td><td>Плохой</td><td>1.3</td><td>520 × 1.3 = 676 грн</td><td>+30% за плохой доступ</td></tr>
          <tr><td>Залом</td><td>Нет</td><td>1.0</td><td>676 грн</td><td>Без изменения</td></tr>
          <tr><td>Залом</td><td>Да</td><td>1.25</td><td>676 × 1.25 = 845 грн</td><td>+25% за залом</td></tr>
          <tr><td>Разборка</td><td>Нет</td><td>1.0</td><td>845 грн</td><td>Без изменения</td></tr>
          <tr><td>Разборка</td><td>Да</td><td>1.15</td><td>845 × 1.15 = 972 грн</td><td>+15% за разборку</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <div class="control-bar">
    <button class="btn" id="addElementBtnFixed">+ Элемент</button>
    <button class="btn secondary" id="addGroupBtnFixed">+ Группа</button>
    <button class="btn ghost" id="clearBtn">Очистить</button>
    <button class="btn danger" id="resetBtn">Сброс данных</button>
  </div>
</div>

<script>
const basePrices={small:400,medium:700,large:1100,xlarge:2000,huge:2500};
const materialFactors={steel:1.0,aluminum:1.3};
const accessFactors={good:1.0,medium:1.2,bad:1.3};
const reinforceFactors={no:1.0,yes:1.25};
const disassemblyFactors={no:1.0,yes:1.15};

let elementCount=0;

function el(tag,props={},children=[]){
  const e=document.createElement(tag);
  Object.entries(props).forEach(([k,v])=>{
    if(k==='class') e.className=v;
    else e.setAttribute(k,v);
  });
  children.forEach(c=>typeof c==='string'? e.appendChild(document.createTextNode(c)): e.appendChild(c));
  return e;
}

function formatCur(v){ return `${Math.round(v)} грн`; }

function createElementBlock(data=null){
  elementCount++;
  const block=el('div',{class:'element-block', 'data-index':elementCount});
  const header=el('div',{class:'element-header'});
  const title=el('h2',{},[`Элемент ${elementCount}`]);
  header.appendChild(title);
  block.appendChild(header);

  const settings=el('div',{class:'form-row'});
  const nameSelect=el('select',{class:'element-name'});
  ['Дверь','Крыло','Капот','Крыша','Багажник','Порог','Бампер'].forEach(v=>nameSelect.appendChild(el('option',{value:v},[v])));
  if(data&&data.name) nameSelect.value=data.name;

  const materialSelect=el('select',{class:'material'});
  materialSelect.innerHTML='<option value="steel">Сталь</option><option value="aluminum">Алюминий</option>';
  if(data&&data.material) materialSelect.value=data.material;

  const accessSelect=el('select',{class:'access'});
  accessSelect.innerHTML='<option value="good">Хороший</option><option value="medium">Средний +20%</option><option value="bad">Плохой +30%</option>';
  if(data&&data.access) accessSelect.value=data.access;

  const reinforceSelect=el('select',{class:'reinforce'});
  reinforceSelect.innerHTML='<option value="no">Залом: Нет</option><option value="yes">Залом: Да +25%</option>';
  if(data&&data.reinforce) reinforceSelect.value=data.reinforce;

  const disassemblySelect=el('select',{class:'disassembly'});
  disassemblySelect.innerHTML='<option value="no">Разбор: Нет</option><option value="yes">Разбор: Да +15%</option>';
  if(data&&data.disassembly) disassemblySelect.value=data.disassembly;

  settings.appendChild(labelWrap('Элемент',nameSelect));
  settings.appendChild(labelWrap('Материал',materialSelect));
  settings.appendChild(labelWrap('Доступ',accessSelect));
  settings.appendChild(labelWrap('Залом',reinforceSelect));
  settings.appendChild(labelWrap('Разбор',disassemblySelect));

  block.appendChild(settings);

  const table=el('table');
  table.innerHTML='<thead><tr><th>Размер вмятин</th><th>Кол-во</th><th style="text-align:right">Цена</th><th></th></tr></thead>';
  table.appendChild(el('tbody'));
  block.appendChild(table);

  if(data&&Array.isArray(data.dents)&&data.dents.length) data.dents.forEach(d=>addDentRow(block,d));
  else addDentRow(block);

  block.querySelectorAll('select,input').forEach(i=>i.addEventListener('change',()=>{ calculateAll(); saveData(); }));

  return block;
}

function labelWrap(labelText,node){
  const wrap=el('label');
  wrap.appendChild(el('div',{},[labelText]));
  wrap.appendChild(node);
  return wrap;
}

function addElement(data=null){
  const block=createElementBlock(data);
  document.getElementById('elements').appendChild(block);
  reorderElements();
  calculateAll(); saveData();
}

function addDentRow(block,data=null){
  const tbody=block.querySelector('tbody');
  const tr=el('tr');
  tr.innerHTML=`
    <td>
      <select class="size">
        <option value="small">до 10 мм (400)</option>
        <option value="medium">10–30 мм (700)</option>
        <option value="large">30–50 мм (1100)</option>
        <option value="xlarge">50–100 мм (2000)</option>
        <option value="huge">&gt;100 мм (2500)</option>
      </select>
    </td>
    <td><input type="number" class="count" value="1" min="1" style="width:86px;padding:8px;border-radius:8px;border:1px solid rgba(15,23,36,0.06)"></td>
    <td class="price">0 грн</td>
    <td style="text-align:right"><button class="btn ghost" title="Удалить группу">✖</button></td>
  `;
  tbody.appendChild(tr);
  if(data){ tr.querySelector('.size').value=data.size; tr.querySelector('.count').value=data.count; }
  tr.querySelectorAll('input,select').forEach(i=>i.addEventListener('input',()=>{ calculateAll(); saveData(); }));
  tr.querySelector('button').addEventListener('click',()=>{ tr.remove(); calculateAll(); saveData(); });
}

function saveData(){
  const data=[];
  document.querySelectorAll('.element-block').forEach(block=>{
    const elData={
      name:block.querySelector('.element-name').value,
      material:block.querySelector('.material').value,
      access:block.querySelector('.access').value,
      reinforce:block.querySelector('.reinforce').value,
      disassembly:block.querySelector('.disassembly').value,
      dents:[]
    };
    block.querySelectorAll('tbody tr').forEach(r=>elData.dents.push({size:r.querySelector('.size').value,count:Number(r.querySelector('.count').value)}));
    data.push(elData);
  });
  localStorage.setItem('pdrData',JSON.stringify(data));
}

function loadData(){
  const saved=JSON.parse(localStorage.getItem('pdrData')||'[]');
  if(saved.length===0) addElement();
  else saved.forEach(s=>addElement(s));
}

function calculateAll(){
  const elements=document.querySelectorAll('.element-block');
  let totalAuto=0,totalDents=0;
  elements.forEach((block,idx)=>{
    const material=materialFactors[block.querySelector('.material').value];
    const access=accessFactors[block.querySelector('.access').value];
    const reinforce=reinforceFactors[block.querySelector('.reinforce').value];
    const disassembly=disassemblyFactors[block.querySelector('.disassembly').value];
    let elementTotal=0;
    block.querySelectorAll('tbody tr').forEach(row=>{
      const base=basePrices[row.querySelector('.size').value];
      const count=Number(row.querySelector('.count').value)||0;
      const price=base*count*material*access*reinforce*disassembly;
      row.querySelector('.price').textContent=formatCur(price);
      elementTotal+=price; totalDents+=count;
    });
    if(!block.querySelector('.element-total')){
      const footer=el('div',{class:'element-footer'});
      const elementTotalDiv=el('div',{class:'element-total'},[`Итого: ${formatCur(elementTotal)}`]);
      footer.appendChild(elementTotalDiv); block.appendChild(footer);
    } else { block.querySelector('.element-total').textContent=`Итого: ${formatCur(elementTotal)}`; }
    totalAuto+=elementTotal;
  });

  const discount=totalDents>10?0.8:1.0;
  const discounted=totalAuto*discount;
  document.getElementById('totalCount').textContent=totalDents;
  if(discount<1){
    document.getElementById('discountValue').textContent=formatCur(totalAuto-discounted);
    document.getElementById('discountLine').style.display='flex';
  } else { document.getElementById('discountLine').style.display='none'; }
  document.getElementById('totalSum').textContent=formatCur(discounted);
}

function reorderElements(){
  document.querySelectorAll('.element-block').forEach((block,idx)=>{
    block.querySelector('.element-header h2').textContent=`Элемент ${idx+1}`;
  });
}

document.getElementById('addElementBtnFixed').addEventListener('click',()=>addElement());
document.getElementById('addGroupBtnFixed').addEventListener('click',()=>{
  const blocks=document.querySelectorAll('.element-block'); 
  if(blocks.length===0) return addElement();
  addDentRow(blocks[blocks.length-1]); calculateAll(); saveData();
});
document.getElementById('clearBtn').addEventListener('click',()=>{
  const els=document.querySelectorAll('.element-block'); 
  if(els.length>0){ els[els.length-1].remove(); reorderElements(); calculateAll(); saveData(); }
});
document.getElementById('resetBtn').addEventListener('click',()=>{ 
  if(confirm('Данные будут удалены. Продолжить?')){ localStorage.removeItem('pdrData'); document.getElementById('elements').innerHTML=''; elementCount=0; addElement(); calculateAll(); } 
});

window.addEventListener('load',()=>{ loadData(); calculateAll(); });
</script>
</body>
</html>
